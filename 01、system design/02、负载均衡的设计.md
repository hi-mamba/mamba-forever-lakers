
<https://www.youtube.com/watch?v=MKiInpoBILY>

<https://juejin.cn/post/6844904196852940808>

<https://www.cnblogs.com/rickiyang/p/11802484.html>

# 负载均衡的设计

## 为什么要负载均衡？

简单来说就是为了满足服务的高可用!

## 负载均衡

硬件负载均衡（如 F5 、A10）、软件负载均衡（如 LVS、Nginx、HAProxy）


## 负载均衡算法
最常见的负载均衡算法有
- 随机
- 加权随机
- 轮询
- 最小连接数
- 一致性哈希


服务器列表
1. 提供一个方法来`新增服务`、`下线服`务等功能
2. 设置了一个定时任务，任务的执行间隔是每 多少秒 执行一次 ping（ping 服务是否OK）
参考这里：Ribbon源码分析---负载均衡实现<https://www.cnblogs.com/rickiyang/p/11802474.html>
```json
protected volatile List<Server> allServerList = Collections.synchronizedList(new ArrayList<Server>());

```
### 1. 随机（Random）

根据后端服务器列表的大小值来`随机选择其中一台`进行访问，代码如下:

使用了一个list来保存所有的服务列表，一个list来保存当前所有的存活状态的服务列表；

```java

public Balanceable choice() {
    int index = (int) (Math.random() * allServerList.length);
    return servers[index];
}
```

- 优点：实现简单，通过系统随机函数随机选择其中一台进行访问
- 缺点：不适用后端机器承载能力不一致的情况


### 2. 权重随机（Weighted Random）



### 3. 轮询（Round Robin）
轮询指的是从已有的后端节点列表中按顺序依次选择一个节点出来提供服务。


### 4. 最小连接数（Least Connections）


### 一致性哈希（Consistent Hash）






